{% extends 'base.html' %}

{% block title %}Login - Book Finder{% endblock %}

{% block content %}
<section class="auth-container">
    <h1>Welcome Back</h1>
    <div class="error-message" id="errorMessage"></div>
    <div class="success-message" id="successMessage"></div>
    <form class="auth-form" id="login" method="POST" onsubmit="validateForm(event)">
        <div class="form-group">
            <label for="email">Email Address</label>
            <input type="email" id="email" name="email" placeholder="Enter your email" required>
        </div>

        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" placeholder="••••••••" required>
        </div>

        <button type="submit">Log In</button>
    </form>

    <div class="auth-links">
        <p>Not a member? <a href="{{ url_for('auth_app.signup_page') }}">Sign up here</a></p>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    function validateForm(event) {
    console.log(event)
    event.preventDefault();  // Prevent the default form submission

    const form = document.getElementById('login');
    const errorMessage = document.getElementById('errorMessage');

    // Clear previous errors
    errorMessage.style.display = 'none';

    // Prepare form data
    const formData = {
        email: form.email.value,
        password: form.password.value
    };

    // Send POST request using fetch API
    fetch('{{ url_for("auth_app.login") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',  // Set the content type to JSON
        },
        body: JSON.stringify(data)  // The body is correctly set to the JSON string
    })
    .then(response => response.json())  // Convert the response into JSON
    .then(data => {
        if (data.message === 'Login successful') {
            window.location.href = "{{ url_for('main_app.search_page') }}";  // Redirect on success
        } else {
            errorMessage.textContent = data.message || 'Login failed';
            errorMessage.style.display = 'block';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        errorMessage.textContent = 'Connection error. Please try again.';
        errorMessage.style.display = 'block';
    });
}
</script>
{% endblock %}
